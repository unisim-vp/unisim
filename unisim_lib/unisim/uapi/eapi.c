/*
                             *******************
******************************* C SOURCE FILE *******************************
**                           *******************                           **
**                                                                         **
** project   : UNISIM C API                                                **
** filename  : eapi.c                                                      **
** version   : 1                                                           **
** date      : 23/5/2011                                                   **
**                                                                         **
*****************************************************************************
**                                                                         **
** Copyright (c) 2011, Commissariat a l'Energie Atomique (CEA)             **
** All rights reserved.                                                    **
**                                                                         **
*****************************************************************************

*/

#define __UNISIM__UAPI__EAPI__C_SRC

/****************************************************************************/
/**                                                                        **/
/**                     MODULES USED                                       **/
/**                                                                        **/
/****************************************************************************/

#include "unisim/uapi/uapi_priv.h"

/****************************************************************************/
/**                                                                        **/
/**                     DEFINITIONS AND MACROS                             **/
/**                                                                        **/
/****************************************************************************/

/****************************************************************************/
/**                                                                        **/
/**                     TYPEDEFS AND STRUCTURES                            **/
/**                                                                        **/
/****************************************************************************/

/****************************************************************************/
/**                                                                        **/
/**                     PROTOTYPES OF LOCAL FUNCTIONS                      **/
/**                                                                        **/
/****************************************************************************/

/****************************************************************************/
/**                                                                        **/
/**                     EXPORTED VARIABLES                                 **/
/**                                                                        **/
/****************************************************************************/

/****************************************************************************/
/**                                                                        **/
/**                     GLOBAL VARIABLES                                   **/
/**                                                                        **/
/****************************************************************************/

/****************************************************************************/
/**                                                                        **/
/**                     EXPORTED FUNCTIONS                                 **/
/**                                                                        **/
/****************************************************************************/

/****************************************************************************/
void usDestroyExtendedAPI(UnisimExtendedAPI api)
/****************************************************************************/
{
	if ( api == 0 ) return;
	
	if ( api->usDestroyAPI != 0 )
		api->usDestroyAPI(api);
	else
	{
		usSimulatorUnregisterExtendedAPI(api->simulator, api);
		api->api = 0;
		api->simulator = 0;
		free(api);
	}
}

/****************************************************************************/
const char *usExtendedAPIGetName(UnisimExtendedAPI api)
/****************************************************************************/
{
	if ( api == 0 ) return 0;

	return api->api->GetName();
}

/****************************************************************************/
const char *usExtendedAPIGetTypeName(UnisimExtendedAPI api)
/****************************************************************************/
{
	if ( api == 0 ) return 0;

	return api->api->GetAPITypeName();
}

/****************************************************************************/
/**                                                                        **/
/**                 PRIVATELY EXPORTED FUNCTIONS                           **/
/**                                                                        **/
/****************************************************************************/

/****************************************************************************/
UnisimExtendedAPI usCreateExtendedAPI(UnisimSimulator simulator,
		unisim::kernel::api::APIBase *unisimApi)
/****************************************************************************/
{
	if ( simulator == 0 ) return 0;
	if ( unisimApi == 0 ) return 0;

	UnisimExtendedAPI api = (UnisimExtendedAPI)malloc(sizeof(_UnisimExtendedAPI));
	if ( api == 0 ) return 0;

	api->simulator = simulator;
	api->api = unisimApi;
	api->usDestroyAPI = 0;
	api->usDestroyUnregisteredAPI = 0;
	usSimulatorRegisterExtendedAPI(simulator, api);
	return api;
}

/****************************************************************************/
void usDestroyUnregisteredExtendedAPI(UnisimExtendedAPI api)
/****************************************************************************/
{
	if ( api == 0 ) return;

	if ( api->usDestroyUnregisteredAPI != 0 )
		api->usDestroyUnregisteredAPI(api);
	else
	{
		api->api = 0;
		api->simulator = 0;
		free(api);
	}
}

/****************************************************************************/
unisim::kernel::api::APIBase *usExtendedAPIGetUnisimAPI(UnisimExtendedAPI api)
/****************************************************************************/
{
	if ( api == 0 ) return 0;

	return api->api;
}

/****************************************************************************/
UnisimSimulator usExtendedAPIGetSimulator(UnisimExtendedAPI api)
/****************************************************************************/
{
	if ( api == 0 ) return 0;

	return api->simulator;
}

/****************************************************************************/
/**                                                                        **/
/**                     LOCAL FUNCTIONS                                    **/
/**                                                                        **/
/****************************************************************************/

/****************************************************************************/
/**                                                                        **/
/**                               EOF                                      **/
/**                                                                        **/
/****************************************************************************/

