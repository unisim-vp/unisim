CC=gcc
RUBBER=rubber

# TLM
TLM_LATEX_SOURCES=tlm/tlm.tex \
tlm/appendix.tex
TLM_CPP_SOURCES= \
tlm/interface1.cpp \
tlm/interface2.cpp \
tlm/interface3.cpp \
tlm/new_operator.cpp \
tlm/memory_req_rsp.cpp \
tlm/utlm_processor.cpp \
tlm/utlm_memory.cpp \
tlm/ttlm_processor.cpp \
tlm/ttlm_memory.cpp \
tlm/ttlm_router.cpp \
tlm/ttlm_router_adv.cpp \
tlm/ttlm_router_adv2.cpp 

TLM_FIGURES= \
tlm/utlm_principle.pdf \
tlm/ttlm_principle.pdf \
tlm/chaining_communication_steps.pdf \
tlm/n_to_m.pdf

TLM_GENERATED_LATEX=$(patsubst %.cpp,%.tex,$(TLM_CPP_SOURCES))

# services
SERVICES_LATEX_SOURCES=services/services.tex
SERVICES_CPP_SOURCES= \
services/instanciation.cpp \
services/connection.cpp \
services/simple_service.cpp \
services/simple_client.cpp \
services/run_time_parameter.cpp
SERVICES_FIGURES=

SERVICES_GENERATED_LATEX=$(patsubst %.cpp,%.tex,$(SERVICES_CPP_SOURCES))

# introduction
INTRODUCTION_LATEX_SOURCES=introduction/introduction.tex
INTRODUCTION_CPP_SOURCES=
INTRODUCTION_FIGURES=

INTRODUCTION_GENERATED_LATEX=$(patsubst %.cpp,%.tex,$(INTRODUCTION_CPP_SOURCES))

# installation
INSTALL_LATEX_SOURCES=installation/install.tex
INSTALL_CPP_SOURCES=
INSTALL_FIGURES=

INSTALL_GENERATED_LATEX=$(patsubst %.cpp,%.tex,$(INSTALL_CPP_SOURCES))

# genisslib
GENISSLIB_LATEX_SOURCES=genisslib/genisslib.tex
GENISSLIB_CPP_SOURCES=
GENISSLIB_FIGURES=

GENISSLIB_GENERATED_LATEX=$(patsubst %.cpp,%.tex,$(GENISSLIB_CPP_SOURCES))

# ppcemu_system
PPCEMU_SYSTEM_LATEX_SOURCES=ppcemu_system/ppcemu_system.tex
PPCEMU_SYSTEM_CPP_SOURCES=
PPCEMU_SYSTEM_FIGURES=ppcemu_system/fig_ppcemu_system.pdf

PPCEMU_SYSTEM_GENERATED_LATEX=$(patsubst %.cpp,%.tex,$(PPCEMU_SYSTEM_CPP_SOURCES))

# ppcemu
PPCEMU_LATEX_SOURCES=ppcemu/ppcemu.tex
PPCEMU_CPP_SOURCES=
PPCEMU_FIGURES=ppcemu/fig_ppcemu.pdf

PPCEMU_GENERATED_LATEX=$(patsubst %.cpp,%.tex,$(PPCEMU_CPP_SOURCES))

# ppcemu
PPCEMU_LATEX_SOURCES=ppcemu/ppcemu.tex
PPCEMU_CPP_SOURCES=
PPCEMU_FIGURES=ppcemu/fig_ppcemu.pdf

PPCEMU_GENERATED_LATEX=$(patsubst %.cpp,%.tex,$(PPCEMU_CPP_SOURCES))

# embedded_ppc_g4_board
EMBEDDED_PPC_G4_BOARD_LATEX_SOURCES=embedded_ppc_g4_board/embedded_ppc_g4_board.tex
EMBEDDED_PPC_G4_BOARD_CPP_SOURCES=
EMBEDDED_PPC_G4_BOARD_FIGURES=embedded_ppc_g4_board/fig_embedded_ppc_g4_board.pdf

EMBEDDED_PPC_G4_BOARD_GENERATED_LATEX=$(patsubst %.cpp,%.tex,$(EMBEDDED_PPC_G4_BOARD_CPP_SOURCES))

# armemu
ARMEMU_LATEX_SOURCES=armemu/armemu.tex
ARMEMU_CPP_SOURCES=
ARMEMU_FIGURES=armemu/fig_armemu.pdf

ARMEMU_GENERATED_LATEX=$(patsubst %.cpp,%.tex,$(ARMEMU_CPP_SOURCES))

# TLM manual
TLM_MANUAL_LATEX_SOURCES=tlm_manual.tex $(TLM_LATEX_SOURCES)
TLM_MANUAL_FIGURES=$(TLM_FIGURES)
TLM_MANUAL_TARGET_PDF=tlm_manual.pdf

# services manual
SERVICES_MANUAL_LATEX_SOURCES=services_manual.tex $(SERVICES_LATEX_SOURCES)
SERVICES_MANUAL_FIGURES=$(SERVICES_FIGURES)
SERVICES_MANUAL_TARGET_PDF=services_manual.pdf

# genisslib manual
GENISSLIB_MANUAL_LATEX_SOURCES=genisslib_manual.tex $(GENISSLIB_LATEX_SOURCES)
GENISSLIB_MANUAL_FIGURES=$(GENISSLIB_FIGURES)
GENISSLIB_MANUAL_TARGET_PDF=genisslib_manual.pdf

# ppcemu-system manual
PPCEMU_SYSTEM_MANUAL_LATEX_SOURCES=ppcemu_system_manual.tex $(PPCEMU_SYSTEM_LATEX_SOURCES)
PPCEMU_SYSTEM_MANUAL_FIGURES=$(PPCEMU_SYSTEM_FIGURES)
PPCEMU_SYSTEM_MANUAL_TARGET_PDF=ppcemu_system_manual.pdf

# ppcemu manual
PPCEMU_MANUAL_LATEX_SOURCES=ppcemu_manual.tex $(PPCEMU_LATEX_SOURCES)
PPCEMU_MANUAL_FIGURES=$(PPCEMU_FIGURES)
PPCEMU_MANUAL_TARGET_PDF=ppcemu_manual.pdf

# embedded_ppc_g4_board manual
EMBEDDED_PPC_G4_BOARD_MANUAL_LATEX_SOURCES=embedded_ppc_g4_board_manual.tex $(EMBEDDED_PPC_G4_BOARD_LATEX_SOURCES)
EMBEDDED_PPC_G4_BOARD_MANUAL_FIGURES=$(EMBEDDED_PPC_G4_BOARD_FIGURES)
EMBEDDED_PPC_G4_BOARD_MANUAL_TARGET_PDF=embedded_ppc_g4_board_manual.pdf

# armemu manual
ARMEMU_MANUAL_LATEX_SOURCES=ppcemu_system_manual.tex $(ARMEMU_LATEX_SOURCES)
ARMEMU_MANUAL_FIGURES=$(ARMEMU_FIGURES)
ARMEMU_MANUAL_TARGET_PDF=ppcemu_system_manual.pdf

# installation manual
INSTALL_MANUAL_LATEX_SOURCES=install_manual.tex $(INSTALL_LATEX_SOURCES)
INSTALL_MANUAL_FIGURES=$(INSTALL_FIGURES)
INSTALL_MANUAL_TARGET_PDF=install_manual.pdf

# Whole manual
MANUAL_LATEX_SOURCES=manual.tex $(INTRODUCTION_LATEX_SOURCES) $(GENISSLIB_LATEX_SOURCES) ${ARMEMU_LATEX_SOURCES} ${PPCEMU_LATEX_SOURCES} ${PPCEMU_SYSTEM_LATEX_SOURCES}  $(EMBEDDED_PPC_G4_BOARD_LATEX_SOURCES) $(TLM_LATEX_SOURCES) $(SERVICES_LATEX_SOURCES) $(INSTALL_LATEX_SOURCES)
MANUAL_GENERATED_LATEX=$(INTRODUCTION_GENERATED_LATEX) $(GENISSLIB_GENERATED_LATEX) ${ARMEMU_GENERATED_LATEX} ${PPCEMU_GENERATED_LATEX} ${PPCEMU_SYSTEM_GENERATED_LATEX} $(EMBEDDED_PPC_G4_BOARD_GENERATED_LATEX) $(TLM_GENERATED_LATEX) $(SERVICES_GENERATED_LATEX) $(INSTALL_GENERATED_LATEX)
MANUAL_FIGURES=logo_unisim.pdf $(INTRODUCTION_FIGURES) $(GENISSLIB_FIGURES) ${ARMEMU_FIGURES} ${PPCEMU_FIGURES} ${PPCEMU_SYSTEM_FIGURES} ${EMBEDDED_PPC_G4_BOARD_FIGURES} $(TLM_FIGURES) $(SERVICES_FIGURES) $(INSTALL_FIGURES)
MANUAL_TARGET_PDF=manual.pdf

all: $(MANUAL_TARGET_PDF) $(GENISSLIB_MANUAL_TARGET_PDF) $(ARMEMU_MANUAL_TARGET_PDF) $(PPCEMU_MANUAL_TARGET_PDF) $(PPCEMU_SYSTEM_MANUAL_TARGET_PDF) $(EMBEDDED_PPC_G4_BOARD_MANUAL_TARGET_PDF) $(TLM_MANUAL_TARGET_PDF) $(SERVICES_MANUAL_TARGET_PDF) $(INSTALL_MANUAL_TARGET_PDF)

clean:
	rm -f $(MANUAL_TARGET_PDF) $(GENISSLIB_MANUAL_TARGET_PDF) $(ARMEMU_MANUAL_TARGET_PDF) $(PPCEMU_MANUAL_TARGET_PDF) $(PPCEMU_SYSTEM_MANUAL_TARGET_PDF) $(EMBEDDED_PPC_G4_BOARD_MANUAL_TARGET_PDF) $(TLM_MANUAL_TARGET_PDF) $(SERVICES_MANUAL_TARGET_PDF) $(MANUAL_GENERATED_LATEX) *.aux *.log *.bbl *.blg *.toc *.lof ./c_to_tex
	
c_to_tex: c_to_tex.c
	$(CC) c_to_tex.c -o c_to_tex

$(TLM_MANUAL_TARGET_PDF): $(TLM_MANUAL_LATEX_SOURCES) $(TLM_GENERATED_LATEX) $(TLM_MANUAL_FIGURES)
$(SERVICES_MANUAL_TARGET_PDF): $(SERVICES_MANUAL_LATEX_SOURCES) $(SERVICES_GENERATED_LATEX) $(SERVICES_MANUAL_FIGURES)
$(INSTALL_MANUAL_TARGET_PDF): $(INSTALL_MANUAL_LATEX_SOURCES) $(INSTALL_GENERATED_LATEX) $(INSTALL_MANUAL_FIGURES)
$(GENISSLIB_MANUAL_TARGET_PDF): $(GENISSLIB_MANUAL_LATEX_SOURCES) $(GENISSLIB_GENERATED_LATEX) $(GENISSLIB_MANUAL_FIGURES)
$(ARMEMU_MANUAL_TARGET_PDF): $(ARMEMU_MANUAL_LATEX_SOURCES) $(ARMEMU_GENERATED_LATEX) $(ARMEMU_MANUAL_FIGURES)
$(PPCEMU_SYSTEM_MANUAL_TARGET_PDF): $(PPCEMU_SYSTEM_MANUAL_LATEX_SOURCES) $(PPCEMU_SYSTEM_GENERATED_LATEX) $(PPCEMU_SYSTEM_MANUAL_FIGURES)
$(PPCEMU_MANUAL_TARGET_PDF): $(PPCEMU_MANUAL_LATEX_SOURCES) $(PPCEMU_GENERATED_LATEX) $(PPCEMU_MANUAL_FIGURES)
$(EMBEDDED_PPC_G4_BOARD_MANUAL_TARGET_PDF): $(EMBEDDED_PPC_G4_BOARD_MANUAL_LATEX_SOURCES) $(EMBEDDED_PPC_G4_BOARD_GENERATED_LATEX) $(EMBEDDED_PPC_G4_BOARD_MANUAL_FIGURES)
$(MANUAL_TARGET_PDF): $(MANUAL_LATEX_SOURCES) $(MANUAL_GENERATED_LATEX) $(MANUAL_FIGURES)

%.tex: %.cpp ./c_to_tex
	./c_to_tex $< $@ 10000 95

%.pdf: %.tex
	$(RUBBER) -d $<

