# Runing QEMU

Options generated by a simple runqemu call from yocto linux environment (5.x ?).

HowTo:
 - locate runqemu (type runqemu) python scripts
 - locate qemu launch (subprocess.Popen)
 - instrument it ! (the script itself shows launched command but connot dry run )

YOCTO-built QEMU:
/opt/yocto/usvp4armv8/tmp/work/x86_64-linux/qemu-helper-native/1.0-r1/recipe-sysroot-native/usr/bin/qemu-system-aarch64

## [Network]:
 <option 1> (tap)
-device virtio-net-device,netdev=net0,mac=52:54:00:12:34:02
-netdev tap,id=net0,ifname=tap0,script=no,downscript=no
(kernel) -append ip=192.168.7.2::192.168.7.1:255.255.255.0

root $ ip tuntap add dev tap0 mode tap user ylhuillier

 <option 2> (user)
-device virtio-net-device,netdev=net0
-netdev user,id=net0

## [Display]
-device VGA,edid=on
-show-cursor
-serial mon:vc
-serial null

## [USB]
-device qemu-xhci
-device usb-tablet
-device usb-kbd

## [RNG]
-object rng-random,filename=/dev/urandom,id=rng0
-device virtio-rng-pci,rng=rng0

## [Hardware]
-machine virt
-cpu cortex-a57

## [NoDisplay]
-nographic

## [Memory]
-m 256
(kernel) -append mem=256M

## [Drive]:
-drive id=disk0,file=/opt/yocto/usvp4armv8/tmp/deploy/images/qemuarm64/core-image-full-cmdline-qemuarm64-20201105123308.rootfs.ext4,if=none,format=raw
-device virtio-blk-device,drive=disk0
(kernel) -append root=/dev/vda rw


## [NoRaid]
(kernel) -append raid=noautodetect 

## [Kernel]
-kernel /opt/yocto/usvp4armv8/tmp/deploy/images/qemuarm64/Image
-append console=ttyAMA0


# Samples
Kernel options (cmdline arguments to appear in -append)

========================
=== Simple Text Boot ===
========================

/opt/yocto/usvp4armv8/tmp/work/x86_64-linux/qemu-helper-native/1.0-r1/recipe-sysroot-native/usr/bin/qemu-system-aarch64 -machine virt -cpu cortex-a57 -nographic -m 256 -drive id=disk0,file=/opt/yocto/usvp4armv8/tmp/deploy/images/qemuarm64/core-image-full-cmdline-qemuarm64-20201105123308.rootfs.ext4,if=none,format=raw -device virtio-blk-device,drive=disk0 -kernel /opt/yocto/usvp4armv8/tmp/deploy/images/qemuarm64/Image -append "raid=noautodetect root=/dev/vda rw mem=256M console=ttyAMA0"

==================================================
=== Simple Text Boot with user network and RNG ===
==================================================

/opt/yocto/usvp4armv8/tmp/work/x86_64-linux/qemu-helper-native/1.0-r1/recipe-sysroot-native/usr/bin/qemu-system-aarch64 -machine virt -cpu cortex-a57 -nographic -m 256 -drive id=disk0,file=/home/ylhuillier/Documents/unisim/arm64vp/build/rootfs.ext4,if=none,format=raw -device virtio-blk-device,drive=disk0 -kernel /opt/yocto/usvp4armv8/tmp/deploy/images/qemuarm64/Image -object rng-random,filename=/dev/urandom,id=rng0 -device virtio-rng-pci,rng=rng0 -device virtio-net-device,netdev=net0 -netdev user,id=net0 -append "raid=noautodetect root=/dev/vda rw mem=256M console=ttyAMA0 ip=192.168.7.2::192.168.7.1:255.255.255.0"

